##########################################################
CREATE PROCEDURE prcTransfareScheduledTasks
	@NEWDB	NVARCHAR(100),
	@OLDDB	NVARCHAR(100),
	@UPDATE [BIT] = 0
AS	
	EXECUTE prcNotSupportedInAzure
	/*
	DECLARE @JOB_ID UNIQUEIDENTIFIER, @S_ID INT, @CUR CURSOR 
	SET @CUR = CURSOR FOR SELECT JOB_ID, STEP_ID FROM MSDB..SYSJOBSTEPS WHERE DATABASE_NAME = @OLDDB
	
	OPEN @CUR
	FETCH FROM @CUR INTO @JOB_ID, @S_ID
	
	IF @UPDATE = 1
	BEGIN
		WHILE @@FETCH_STATUS = 0
		BEGIN
			EXEC MSDB..SP_UPDATE_JOBSTEP @JOB_ID = @JOB_ID, @STEP_ID = @S_ID, @DATABASE_NAME = @NEWDB
			FETCH FROM @CUR INTO @JOB_ID, @S_ID
		END
		
		CLOSE @CUR
		
		RETURN
	END
	
	WHILE @@FETCH_STATUS = 0
	BEGIN
		DECLARE	@STEP_ID INT,
			@STEP_NAME SYSNAME,
			@SUBSYSTEM NVARCHAR(40),
			@COMMAND NVARCHAR(3200),
			@CMDEXEC_SUCCESS_CODE INT,
			@ON_SUCCESS_ACTION TINYINT,
			@ON_SUCCESS_STEP_ID INT,
			@ON_FAIL_ACTION TINYINT,
			@ON_FAIL_STEP_ID INT,
			@SERVER SYSNAME,
			@DATABASE_NAME SYSNAME,
			@DATABASE_USER_NAME SYSNAME,
			@RETRY_ATTEMPTS INT,
			@RETRY_INTERVAL INT,
			@OS_RUN_PRIORITY INT,
			@OUTPUT_FILE_NAME NVARCHAR(200),
			@FLAGS INT
		
		DECLARE @C CURSOR 
		SET @C = CURSOR FOR 
		SELECT STEP_ID, STEP_NAME, SUBSYSTEM, COMMAND, CMDEXEC_SUCCESS_CODE, ON_SUCCESS_ACTION, ON_SUCCESS_STEP_ID, ON_FAIL_ACTION, ON_FAIL_STEP_ID, SERVER, DATABASE_NAME, DATABASE_USER_NAME, RETRY_ATTEMPTS, RETRY_INTERVAL, OS_RUN_PRIORITY, OUTPUT_FILE_NAME, FLAGS FROM MSDB..SYSJOBSTEPS
		
		OPEN @C 
		FETCH FROM @C INTO @STEP_ID, @STEP_NAME, @SUBSYSTEM, @COMMAND, @CMDEXEC_SUCCESS_CODE, @ON_SUCCESS_ACTION, @ON_SUCCESS_STEP_ID, @ON_FAIL_ACTION, @ON_FAIL_STEP_ID, @SERVER, @DATABASE_NAME, @DATABASE_USER_NAME, @RETRY_ATTEMPTS, @RETRY_INTERVAL, @OS_RUN_PRIORITY, @OUTPUT_FILE_NAME, @FLAGS
		
		WHILE @@FETCH_STATUS = 0
		BEGIN
			EXEC MSDB..SP_ADD_JOBSTEP 
				@JOB_ID,
				@STEP_ID,
				@STEP_NAME,
				@SUBSYSTEM,
				@COMMAND,
				NULL,
				@CMDEXEC_SUCCESS_CODE,
				@ON_SUCCESS_ACTION,
				@ON_SUCCESS_STEP_ID,
				@ON_FAIL_ACTION,
				@ON_FAIL_STEP_ID,
				@SERVER,
				@NEWDB,
				@DATABASE_USER_NAME,
				@RETRY_ATTEMPTS,
				@RETRY_INTERVAL,
				@OS_RUN_PRIORITY,
				@OUTPUT_FILE_NAME,
				@FLAGS
			
			FETCH FROM @C INTO @STEP_ID, @STEP_NAME, @SUBSYSTEM, @COMMAND, @CMDEXEC_SUCCESS_CODE, @ON_SUCCESS_ACTION, @ON_SUCCESS_STEP_ID, @ON_FAIL_ACTION, @ON_FAIL_STEP_ID, @SERVER, @DATABASE_NAME, @DATABASE_USER_NAME, @RETRY_ATTEMPTS, @RETRY_INTERVAL, @OS_RUN_PRIORITY, @OUTPUT_FILE_NAME, @FLAGS
		END
		
		CLOSE @C
		
		FETCH FROM @CUR INTO @JOB_ID
	END
	
	CLOSE @CUR
	*/
##########################################################
CREATE PROCEDURE CopyPartproCh

	@DestDBName [NVARCHAR](255)

AS

DECLARE @SQL NVARCHAR (2000), @C CURSOR,
			@Guid UNIQUEIDENTIFIER,
			@Temp FLOAT

SELECT * INTO #RESULT FROM CH000 CH WHERE CH.STATE = 64

	SET @C = CURSOR FAST_FORWARD FOR   
		SELECT GUID FROM #RESULT

	OPEN @C FETCH FROM @C INTO @GUID

	WHILE @@FETCH_STATUS = 0 

	BEGIN 
		SET @Temp = dbo.fnCheck_GetCollectedValue( @guid)
		SET @SQL='UPDATE #RESULT SET VAL = ( VAL) - (' + CAST( @Temp AS NVARCHAR(250))+ ' * CurrencyVal ),NOTES = ''„Õ’·… Ã“∆Ì« „‰ «·› —… «·”«»ﬁ… '' ,TRANSFERCHECK  = 1 WHERE GUID = ''' + CAST( @GUID AS NVARCHAR(250))+'''' 
		EXEC (@SQL)
		FETCH @C INTO @GUID 
	END
	CLOSE @C
	DEALLOCATE @C

	DELETE #RESULT WHERE VAL <= 0


	SET @SQL = ' ALTER TABLE '+ @DestDBName + '..ch000 DISABLE TRIGGER ALL 

	   INSERT INTO '+ @DestDBName +'..ch000 SELECT * FROM #RESULT ' 

	 EXEC (@SQL)

	 SET @SQL = 'ALTER TABLE '+ @DestDBName + '..ch000 ENABLE TRIGGER ALL'

	 EXEC (@SQL)
##########################################################
CREATE PROCEDURE CopyPartproFA

	@DestDBName [NVARCHAR](255)

AS

	 DECLARE @SQL NVARCHAR (2000), @C CURSOR, @Guid UNIQUEIDENTIFIER

	 SELECT * INTO #RESULT  FROM FavAcc000

	 SET @SQL = ' ALTER TABLE '+ @DestDBName + '..FavAcc000 DISABLE TRIGGER ALL 

	   INSERT INTO '+ @DestDBName +'..FavAcc000 SELECT * FROM #RESULT ' 

	 EXEC (@SQL)

	 SET @SQL = 'ALTER TABLE '+ @DestDBName + '..FavAcc000 ENABLE TRIGGER ALL'

	 EXEC (@SQL)
##########################################################
