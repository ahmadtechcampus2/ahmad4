####################################################################
CREATE VIEW vwMtGrMS
AS
	SELECT
		[mtGUID],
		[mtNumber],
		[mtName],
		[mtCode],
		[mtLatinName],
		[mtBarCode],
		[mtCodedCode],
		[mtGroup],
		[mtUnity],
		[mtSpec],
		[mtQty],
		[mtHigh],
		[mtLow],
		[mtWhole],
		[mtHalf],
		[mtRetail],
		[mtEndUser],
		[mtExport],
		[mtVendor],
		[mtMaxPrice],
		[mtAvgPrice],
		[mtLastPrice],
		[mtWhole2],
		[mtHalf2],
		[mtRetail2],
		[mtEndUser2],
		[mtExport2],
		[mtVendor2],
		[mtMaxPrice2],
		[mtLastPrice2],
		[mtWhole3],
		[mtHalf3],
		[mtRetail3],
		[mtEndUser3],
		[mtExport3],
		[mtVendor3],
		[mtMaxPrice3],
		[mtLastPrice3],
		[mtPriceType],
		[mtSellType],
		[mtBonusOne],
		[mtPicture],
		[mtCurrencyVal],
		[mtCurrencyPtr],
		[mtUseFlag],
		[mtOrigin],
		[mtCompany],
		[mtType],
		[mtSecurity],
		[mtLastPriceDate],
		[mtBonus],
		[mtUnit2],
		[mtUnit2Fact],
		[mtUnit3],
		[mtUnit3Fact],
		[mtFlag],
		[mtPos],
		[mtDim],
		[mtDefUnitFact],
		[mtDefUnitName],
		[mtDefUnit],
		[mtExpireFlag],
		[mtProductionFlag],
		[mtUnit2FactFlag],
		[mtUnit3FactFlag],
		[mtBarCode2],
		[mtBarCode3],
		[mtSNFlag],
		[mtForceInSN],
		[mtForceOutSN],
		[mtVat],
		[mtColor],
		[mtProvenance],
		[mtQuality],
		[mtModel],
		m.mtHide,
		[grGUID],
		[grName],
		[grCode],
		ISNULL([s].[msStorePtr], 0x00) AS [StorePtr],
		ISNULL([s].[stName], '') AS [stName],
		ISNULL([s].[stLatinName], '') AS [stLatinName],
		ISNULL([s].[msQty], 0) AS [msQty]
	FROM
		[vwMtGr] AS [m] LEFT JOIN [vwMsSt] AS [s] 
		ON [m].[mtGuid] = [msMatPtr]
####################################################################
CREATE FUNCTION fnGetMaterialQty(@mtGUID UNIQUEIDENTIFIER)
	RETURNS TABLE
AS RETURN 
	SELECT SUM([msQty]) AS [msQty] FROM [vwMs] WHERE msMatPtr = @mtGUID
####################################################################
CREATE VIEW vwMtGrMs_Branch
AS 
	SELECT 
		[mtGUID], 
		[mtNumber], 
		[mtName], 
		[mtCode], 
		[mtLatinName], 
		[mtBarCode], 
		[mtCodedCode], 
		[mtGroup], 
		[mtUnity], 
		[mtSpec], 
		--[mtQty], 
		[mtHigh], 
		[mtLow], 
		[mtWhole], 
		[mtHalf], 
		[mtRetail], 
		[mtEndUser], 
		[mtExport], 
		[mtVendor], 
		[mtMaxPrice], 
		[mtAvgPrice], 
		[mtLastPrice], 
		[mtWhole2], 
		[mtHalf2], 
		[mtRetail2], 
		[mtEndUser2], 
		[mtExport2], 
		[mtVendor2], 
		[mtMaxPrice2], 
		[mtLastPrice2], 
		[mtWhole3], 
		[mtHalf3], 
		[mtRetail3], 
		[mtEndUser3], 
		[mtExport3], 
		[mtVendor3], 
		[mtMaxPrice3], 
		[mtLastPrice3], 
		[mtPriceType], 
		[mtSellType], 
		[mtBonusOne], 
		[mtPicture], 
		[mtCurrencyVal], 
		[mtCurrencyPtr], 
		[mtUseFlag], 
		[mtOrigin], 
		[mtCompany], 
		[mtType], 
		[mtSecurity], 
		[mtLastPriceDate], 
		[mtBonus], 
		[mtUnit2], 
		[mtUnit2Fact], 
		[mtUnit3], 
		[mtUnit3Fact], 
		[mtFlag], 
		[mtPos], 
		[mtDim], 
		[mtDefUnitFact], 
		[mtDefUnitName], 
		[mtDefUnit], 
		[mtExpireFlag], 
		[mtProductionFlag], 
		[mtUnit2FactFlag], 
		[mtUnit3FactFlag], 
		[mtBarCode2], 
		[mtBarCode3], 
		[mtSNFlag], 
		[mtForceInSN], 
		[mtForceOutSN], 
		[mtVat], 
		[mtColor], 
		[mtProvenance], 
		[mtQuality], 
		[mtModel],
		[mtHide], 
		[grGUID], 
		[grName], 
		[grCode],
		ISNULL([ms].[msQty], 0) AS [mtQty]
	FROM 
		[vwMtGr] AS [m] 
		OUTER APPLY dbo.fnGetMaterialQty([m].[mtGuid]) AS ms
###############################################################################
#END